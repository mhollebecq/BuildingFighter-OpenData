<% layout('templates/layout') -%>

<label for="communeSearch">Commune</label>
<input type="text" id="communeSearch" name="communeSearch" value="Toulo"/>
<button value="Valider" onclick="search();" >Validate</button>
<ul id="searchResults"></ul>

<script type="text/javascript">

function search(){
    var searchContent = document.getElementsByName("communeSearch")[0];
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var searchResults = JSON.parse(xhttp.responseText);
            var searchResultsUl = document.getElementById("searchResults");
            searchResultsUl.innerHTML = "";
            for(var i =0;i<searchResults.length;i++){
                var commune = searchResults[i];
                var li = document.createElement("li");
                var link = document.createElement("a");
                link.setAttribute("href", "/board/"+commune.com);
                link.append(commune.libelle + " (" + commune.dep+")" );
                li.appendChild(link);
                searchResultsUl.appendChild(li);
            }
        }
    };
    xhttp.open("GET", baseServiceUrl+ "/api/communes?search="+searchContent.value, true);
    xhttp.send();
}
</script>
